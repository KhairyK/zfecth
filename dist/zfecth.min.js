/*
 * 2025 By PHPin
 * MIT LICENSE
 * ZJS TYPE ZFECTH
 * See The Original File In https://cdn.kyrt.my.id/libs/js/zfecth/zfecth.js
*/

!function(e){let t=e=>e&&"object"==typeof e&&!Array.isArray(e),n=async e=>{try{return await e.json()}catch{return null}};function r(e={}){let r=new Map,o=[],a=[],s={baseURL:e.baseURL||"",timeout:e.timeout||0,headers:Object.assign({},e.headers||{}),interceptors:{request:[],response:[]},transformRequest:[],transformResponse:[],maxConcurrent:e.maxConcurrent||1/0};t(s.baseURL)&&"function"==typeof s.baseURL.resolve?s.baseURL=s.baseURL.resolve():"object"==typeof s.baseURL&&"function"==typeof s.baseURL.toString&&(s.baseURL=s.baseURL.toString());let i=0,l=[];function u(e,t,n){let r="";try{r=n?JSON.stringify(n):""}catch{r=String(n)}return`${e.toUpperCase()}::${t}::${r}`}function c(e){let t=e;for(let n of s.interceptors.response)try{t=n(t)||t}catch(r){}return t}function d(e,t){let n=e;for(let r of s.transformResponse)try{n=r(n,t)||n}catch{}return n}function f(e,t){for(let n of a)try{n(e,t)}catch(r){}}async function p(e){let{url:t,options:n,retries:r=0,retryDelay:o=300,retryOn:a=[429,502,503,504],timeout:s}=e,i=0,l=Date.now();for(;;){i++;let u=new AbortController;n.signal&&n.signal.addEventListener("abort",()=>u.abort(),{once:!0});let c;s>0&&(c=setTimeout(()=>u.abort(new DOMException("timeout","AbortError")),s));let d=Object.assign({},n,{signal:u.signal}),f;try{f=await fetch(t,d),c&&clearTimeout(c)}catch(p){if(c&&clearTimeout(c),u.signal.aborted&&p&&"AbortError"===p.name)throw p;if(i<=r){let h=o*Math.pow(2,i-1),g=Math.floor(Math.random()*o);await new Promise(e=>setTimeout(e,h+g));continue}throw p}if(!f.ok&&i<=r&&a.includes(f.status)){let y=o*Math.pow(2,i-1),b=Math.floor(Math.random()*o);await new Promise(e=>setTimeout(e,y+b));continue}let m=Date.now()-l;return{res:f,duration:m}}}async function h(e,t,o={}){var a;let h=function e(t){if(!t)return s.baseURL||"";if(/^https?:\/\//i.test(t))return t;let n=s.baseURL||"";return n?n.endsWith("/")||t.startsWith("/")?`${n}${t.replace(/^\//,"")}`:`${n}/${t}`:t}(t),g=Object.assign({},s.headers,o.headers||{}),y=o.body,b="timeout"in o?o.timeout:s.timeout,m="retry"in o?o.retry:o.retries||0,$=o.retryDelay||300,w=o.cache||0,R=o.group&&o.group.signal?o.group.signal:null;y=function e(t,n){let r=t;for(let o of s.transformRequest)try{r=o(r,n)||r}catch{}return r}(y,g);let v={method:e.toUpperCase(),headers:g,body:void 0};if(null!=y&&"GET"!==e&&"HEAD"!==e){let L=v.headers&&v.headers["Content-Type"]||v.headers&&v.headers["content-type"];L&&L.includes("application/json")&&"string"!=typeof y?v.body=JSON.stringify(y):v.body=y}if(o.signal&&(v.signal=o.signal),R){let T=new AbortController;v.signal&&v.signal.addEventListener("abort",()=>T.abort(),{once:!0}),R.addEventListener("abort",()=>T.abort(),{once:!0}),v.signal=T.signal}let C={url:h,method:v.method,options:v,timeout:b,retries:m,retryDelay:$,cacheTTL:w,original:{url:t,opts:o}};v=(C=function e(t){let n=t;for(let r of s.interceptors.request)try{n=r(n)||n}catch(o){}return n}(C)||C).options,b=C.timeout;let U=C.url,x=u(C.method,U,v.body);if("GET"===C.method&&w>0){let E=function e(t){let n=r.get(t);return n?n.expiresAt&&Date.now()>n.expiresAt?(r.delete(t),null):n.value:null}(x);if(E){let q=Object.assign({},E);return(q=c(q)||q).data=d(q.data,q)||q.data,q}}let A=async()=>{let e;try{e=await p({url:U,options:v,retries:C.retries,retryDelay:C.retryDelay,timeout:b})}catch(t){let o={ok:!1,status:0,data:null,error:t,config:C};return f(t,C),o}let{res:a,duration:s}=e,i=a.headers.get("Content-Type")||"",l=null;l=i.includes("application/json")?await n(a):await a.text().catch(()=>null);let u={ok:a.ok,status:a.status,statusText:a.statusText,headers:a.headers,data:l,config:C,time:s};u.data=d(u.data,u);let h=c(u)||u;if(!a.ok){let g=Error(`HTTP ${a.status} ${a.statusText}`);return g.status=a.status,g.response=h,f(g,C),{ok:!1,status:a.status,data:l,error:g,config:C}}return"GET"===C.method&&w>0&&r.set(x,{value:h,expiresAt:w>0?Date.now()+1e3*w:null}),h};return a=A,new Promise((e,t)=>{let n=()=>{i++,a().then(e,t).finally(()=>{if(i--,l.length){let e=l.shift();e()}})};i<s.maxConcurrent?n():l.push(n)})}let g={};return["get","post","put","patch","delete","head"].forEach(e=>{g[e]=(n,r={},o={})=>{let a=null,s={};if("get"===e||"head"===e||"delete"===e)s=r||{};else{a=r,(s=o||{}).headers||(s.headers={});let i=(s.headers["Content-Type"]||s.headers["content-type"]||"").toLowerCase();!i&&t(a)&&(s.headers["Content-Type"]="application/json"),s.body=a}return h(e,n,s)}}),g.request=(e={})=>{let t=(e.method||"GET").toLowerCase(),n=e.url||e.path||e.pathname||"";return["get","post","put","patch","delete","head"].includes(t)?"get"===t||"head"===t||"delete"===t?g[t](n,e):g[t](n,e.data||e.body||{},e):h(t,n,e)},g.use=function(e={}){return"function"==typeof e.request&&s.interceptors.request.push(e.request),"function"==typeof e.response&&s.interceptors.response.push(e.response),g},g.addTransformRequest=e=>("function"==typeof e&&s.transformRequest.push(e),g),g.addTransformResponse=e=>("function"==typeof e&&s.transformResponse.push(e),g),g.usePlugin=function(e){if("function"==typeof e)try{e(g,s),o.push(e)}catch(t){}return g},g.onError=function(e){return"function"==typeof e&&a.push(e),g},g.CancelToken=function e(){let t=new AbortController;return{signal:t.signal,cancel:()=>t.abort()}},g.cancelGroup=function e(){let t=new AbortController;return{signal:t.signal,cancel:e=>t.abort(e)}},g.all=function(e){return Promise.all(e)},g.setToken=function(e,t="Bearer"){return e?s.headers.Authorization=`${t} ${e}`:delete s.headers.Authorization,g},g.clearCache=function(){return r.clear(),g},g.deleteCacheKey=function(e,t,n){return r.delete(u(e,t,n)),g},g.config=s,g._internal={memoryCache:r,plugins:o,globalErrors:a},g}r.env=function(){return function e(){let t={dev:null,prod:null,staging:null,other:{}},n={dev:e=>(t.dev=e,n),prod:e=>(t.prod=e,n),staging:e=>(t.staging=e,n),otherEnv:(e,r)=>(t.other[e]=r,n),resolve(e="undefined"!=typeof location&&location.hostname?location.hostname:""){let n=e.toLowerCase();return n.includes("localhost")||n.startsWith("127.")||"0.0.0.0"===n?t.dev||t.prod||"":n.includes("staging")?t.staging||t.prod||t.dev||"":t.prod||t.dev||""},toString:()=>n.resolve(),_ctx:t};return n}()},"undefined"!=typeof module&&module.exports?module.exports=r:e.zjs=r}("undefined"!=typeof window?window:globalThis);
